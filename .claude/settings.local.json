{
  "permissions": {
    "allow": [
      "mcp__ide__executeCode",
      "Bash(dir:*)",
      "Bash(python:*)",
      "Bash(python3 << 'PYTHON_EOF'\nimport xml.etree.ElementTree as ET\nimport os\n\ndef extract_document_text\\(docx_path, extract_dir\\):\n    \"\"\"Extract all text from a DOCX file\"\"\"\n    os.system\\(f'cd /tmp && unzip -q \"{docx_path}\" -d {extract_dir} 2>&1'\\)\n    \n    tree = ET.parse\\(f'/tmp/{extract_dir}/word/document.xml'\\)\n    root = tree.getroot\\(\\)\n    \n    # Define namespace\n    ns = {'w': 'http://schemas.openxmlformats.org/wordprocessingml/2006/main'}\n    \n    # Extract all text elements\n    text_elements = []\n    for elem in root.findall\\('.//w:t', ns\\):\n        if elem.text:\n            text_elements.append\\(elem.text\\)\n    \n    return ' '.join\\(text_elements\\)\n\n# Document 1\ndoc1_text = extract_document_text\\(\n    \"/e/erp/documents/Erp Screen Mapping – Sop To System Functional Mapping.docx\",\n    \"docx1\"\n\\)\n\nprint\\(\"=\" * 80\\)\nprint\\(\"DOCUMENT 1: ERP Screen Mapping - SOP to System Functional Mapping\"\\)\nprint\\(\"=\" * 80\\)\nprint\\(doc1_text\\)\nprint\\(\"\\\\n\"\\)\n\nPYTHON_EOF)",
      "Bash(python3:*)",
      "Bash(unzip:*)",
      "Bash(ls:*)",
      "Bash(node --version:*)",
      "Bash(npm:*)",
      "Bash(npx create-next-app@latest:*)",
      "Bash(npx shadcn@latest init:*)",
      "Bash(npx shadcn@latest add button input table dialog select dropdown-menu badge card tabs form toast sheet separator label textarea scroll-area avatar tooltip sonner --yes)",
      "Bash(npx shadcn@latest add:*)",
      "Bash(npx prisma init)",
      "Bash(cd:*)",
      "Bash(node -e:*)",
      "Bash(where:*)",
      "Bash(docker:*)",
      "Bash(npx prisma validate:*)",
      "Bash(npx prisma generate:*)",
      "Bash(npx prisma migrate dev:*)",
      "Bash(npx prisma dev:*)",
      "Bash(npx prisma db seed:*)",
      "Bash(npx next build)",
      "Bash(timeout 15 npx next dev:*)",
      "Bash(timeout 20 npx next dev:*)",
      "Bash(npx ts-node:*)",
      "Bash(npx prisma db push:*)",
      "Bash(npx prisma migrate:*)",
      "Bash(taskkill:*)",
      "Bash(npx kill-port:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(wc:*)",
      "Bash(done)",
      "Bash(npx --no-install prisma generate:*)",
      "Bash(./node_modules/.bin/prisma generate:*)",
      "Bash(sudo chown:*)",
      "Bash(pg_isready:*)",
      "Bash(brew list:*)",
      "Bash(brew install:*)",
      "Bash(brew services:*)",
      "Bash(/opt/homebrew/opt/postgresql@17/bin/createdb nps_erp)",
      "Bash(export PATH=\"/opt/homebrew/opt/postgresql@17/bin:$PATH\")",
      "Bash(grep:*)",
      "Bash(xargs -I {} sh -c 'echo \"\"File: {}\"\" && grep -E \"\"href=|router\\\\.push\"\" {} | head -3')",
      "Bash(npx:*)",
      "Bash(npm_config_cache=/tmp/npm-cache-temp npx:*)",
      "Bash(git -C /Users/adi0220/projects/erp-claude remote:*)",
      "Bash(render:*)",
      "Bash(/e/erp/src/app/api/health/route.ts << 'EOF'\n/**\n * Health Check Endpoint for Render\n * Used for deployment health monitoring\n */\n\nimport { NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\n\nexport async function GET\\(\\) {\n  try {\n    // Check database connection\n    await prisma.$queryRaw`SELECT 1`;\n\n    return NextResponse.json\\({\n      status: 'healthy',\n      timestamp: new Date\\(\\).toISOString\\(\\),\n      database: 'connected',\n      service: 'nps-erp',\n    }\\);\n  } catch \\(error\\) {\n    return NextResponse.json\\(\n      {\n        status: 'unhealthy',\n        timestamp: new Date\\(\\).toISOString\\(\\),\n        database: 'disconnected',\n        error: error instanceof Error ? error.message : 'Unknown error',\n      },\n      { status: 503 }\n    \\);\n  }\n}\nEOF)",
      "Bash(/e/erp/.env.production.example << 'EOF'\n# Production Environment Variables for Render Deployment\n\n# Database\nDATABASE_URL=\"postgresql://user:password@host:5432/database?schema=public&connection_limit=10&pool_timeout=20\"\nSHADOW_DATABASE_URL=\"postgresql://user:password@host:5432/database_shadow?schema=public\"\n\n# Authentication\nNEXTAUTH_URL=\"https://your-app-name.onrender.com\"\nNEXTAUTH_SECRET=\"your-nextauth-secret-here\"\nJWT_SECRET=\"your-jwt-secret-here\"\n\n# Node Environment\nNODE_ENV=\"production\"\nNODE_OPTIONS=\"--max-old-space-size=4096\"\n\n# Optional: Email Configuration \\(for future use\\)\n# SMTP_HOST=\"smtp.gmail.com\"\n# SMTP_PORT=\"587\"\n# SMTP_USER=\"your-email@gmail.com\"\n# SMTP_PASSWORD=\"your-app-password\"\n# SMTP_FROM=\"noreply@nps-erp.com\"\nEOF)",
      "Bash(/e/erp/project_documents/RENDER_DEPLOYMENT_GUIDE.md << 'EOF'\n# Render Deployment Guide - NPS ERP System\n\n**Date:** February 12, 2026\n**Platform:** Render.com\n**Application:** NPS ERP \\(Next.js + PostgreSQL + Prisma\\)\n\n---\n\n## Table of Contents\n\n1. [Prerequisites]\\(#prerequisites\\)\n2. [Deployment Methods]\\(#deployment-methods\\)\n3. [Method 1: Blueprint Deployment \\(Recommended\\)]\\(#method-1-blueprint-deployment-recommended\\)\n4. [Method 2: Manual Deployment]\\(#method-2-manual-deployment\\)\n5. [Post-Deployment Steps]\\(#post-deployment-steps\\)\n6. [Database Seeding]\\(#database-seeding\\)\n7. [Troubleshooting]\\(#troubleshooting\\)\n8. [Monitoring & Maintenance]\\(#monitoring--maintenance\\)\n\n---\n\n## Prerequisites\n\n### 1. Render Account\n- Sign up at [render.com]\\(https://render.com\\)\n- Verify your email address\n- \\(Optional\\) Add payment method for paid plans\n\n### 2. GitHub Repository\n- Push your code to GitHub\n- Ensure all files are committed\n- Repository must be public or you need Render GitHub access\n\n### 3. Local Setup Verification\n```bash\n# Verify build works locally\nnpm run build\n\n# Verify TypeScript compilation\nnpx tsc --noEmit\n\n# Verify Prisma schema\nnpx prisma validate\n```\n\n---\n\n## Deployment Methods\n\n### Quick Comparison\n\n| Method | Ease | Control | Best For |\n|--------|------|---------|----------|\n| Blueprint | ⭐⭐⭐⭐⭐ Easy | Medium | First-time deployment |\n| Manual | ⭐⭐⭐ Medium | High | Custom configuration |\n\n---\n\n## Method 1: Blueprint Deployment \\(Recommended\\)\n\nThis method uses the `render.yaml` file to automatically set up all services.\n\n### Step 1: Prepare Your Repository\n\n1. **Ensure files are present:**\n   ```bash\n   ls render.yaml                           # Deployment config\n   ls src/app/api/health/route.ts          # Health check endpoint\n   ls .env.production.example              # Environment example\n   ```\n\n2. **Commit and push to GitHub:**\n   ```bash\n   git add .\n   git commit -m \"feat: Add Render deployment configuration\"\n   git push origin master\n   ```\n\n### Step 2: Create New Service on Render\n\n1. **Go to Render Dashboard:**\n   - Visit [dashboard.render.com]\\(https://dashboard.render.com\\)\n   - Click **\"New +\"** button\n   - Select **\"Blueprint\"**\n\n2. **Connect Repository:**\n   - Choose **\"Connect a repository\"**\n   - Select your GitHub account\n   - Choose the `nps-erp` repository\n   - Click **\"Connect\"**\n\n3. **Review Blueprint:**\n   - Render will detect `render.yaml`\n   - Review the services that will be created:\n     - `nps-erp-db` \\(PostgreSQL database\\)\n     - `nps-erp-web` \\(Next.js web service\\)\n\n4. **Configure Service Names:**\n   - Change service names if desired\n   - Update `NEXTAUTH_URL` in render.yaml to match your web service name\n   - Default: `https://nps-erp-web.onrender.com`\n\n### Step 3: Deploy Services\n\n1. **Click \"Apply\"**\n   - Render will start creating services\n   - Database will be created first\n   - Web service will deploy after database is ready\n\n2. **Monitor Build Logs:**\n   - Click on `nps-erp-web` service\n   - View **\"Logs\"** tab\n   - Wait for build to complete \\(5-10 minutes first time\\)\n\n### Step 4: Verify Deployment\n\n```bash\n# Check health endpoint\ncurl https://nps-erp-web.onrender.com/api/health\n\n# Expected response:\n{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2026-02-12T...\",\n  \"database\": \"connected\",\n  \"service\": \"nps-erp\"\n}\n```\n\n---\n\n## Method 2: Manual Deployment\n\nUse this method for custom configuration or if blueprint fails.\n\n### Step 1: Create PostgreSQL Database\n\n1. **Go to Render Dashboard**\n   - Click **\"New +\"**\n   - Select **\"PostgreSQL\"**\n\n2. **Configure Database:**\n   - **Name:** `nps-erp-db`\n   - **Database:** `nps_erp_production`\n   - **User:** `nps_erp_user`\n   - **Region:** Singapore \\(or nearest to your users\\)\n   - **PostgreSQL Version:** 15\n   - **Plan:** Starter \\($7/month\\) or Free\n\n3. **Create Database**\n   - Wait for provisioning \\(2-3 minutes\\)\n   - Copy **Internal Database URL** \\(starts with `postgresql://`\\)\n\n### Step 2: Create Web Service\n\n1. **Go to Render Dashboard**\n   - Click **\"New +\"**\n   - Select **\"Web Service\"**\n\n2. **Connect Repository:**\n   - Connect your GitHub account\n   - Select `nps-erp` repository\n   - Branch: `master`\n\n3. **Configure Service:**\n   ```\n   Name: nps-erp-web\n   Region: Singapore \\(same as database\\)\n   Branch: master\n   Runtime: Node\n   \n   Build Command:\n   npm ci && npx prisma generate && npx prisma migrate deploy && npm run build\n   \n   Start Command:\n   npm start\n   \n   Plan: Starter \\($7/month\\) or Free\n   ```\n\n4. **Add Environment Variables:**\n   Click **\"Advanced\"** and add:\n\n   ```\n   NODE_ENV = production\n   \n   DATABASE_URL = [Paste Internal Database URL from Step 1]\n   \n   SHADOW_DATABASE_URL = [Same as DATABASE_URL]\n   \n   NEXTAUTH_URL = https://nps-erp-web.onrender.com\n   \n   NEXTAUTH_SECRET = [Generate random string - see below]\n   \n   JWT_SECRET = [Generate random string - see below]\n   \n   NODE_OPTIONS = --max-old-space-size=4096\n   ```\n\n   **Generate Secrets:**\n   ```bash\n   # Run locally to generate secure secrets:\n   node -e \"console.log\\(require\\('crypto'\\).randomBytes\\(32\\).toString\\('hex'\\)\\)\"\n   # Use output for NEXTAUTH_SECRET\n   \n   node -e \"console.log\\(require\\('crypto'\\).randomBytes\\(32\\).toString\\('hex'\\)\\)\"\n   # Use output for JWT_SECRET\n   ```\n\n5. **Health Check Path:**\n   - Scroll to **\"Health Check\"**\n   - Path: `/api/health`\n\n6. **Create Web Service**\n   - Click **\"Create Web Service\"**\n   - Monitor build logs \\(5-10 minutes\\)\n\n---\n\n## Post-Deployment Steps\n\n### Step 1: Verify Health Check\n\n```bash\ncurl https://your-app-name.onrender.com/api/health\n```\n\n### Step 2: Run Database Migrations\n\nMigrations run automatically during build, but verify:\n\n1. **Check Logs:**\n   - Go to your web service\n   - View **\"Logs\"**\n   - Look for: `✓ Prisma migrate deploy completed`\n\n2. **Verify Tables:**\n   - Go to database service\n   - Click **\"Connect\"** → **\"External Connection\"**\n   - Use pgAdmin or similar to check tables\n\n### Step 3: Access Admin Panel\n\n1. **Open Application:**\n   ```\n   https://your-app-name.onrender.com/login\n   ```\n\n2. **Login with Default Admin:**\n   ```\n   Email: admin@erp.com\n   Password: Admin@123\n   ```\n\n3. **Change Admin Password Immediately!**\n   - Go to Settings → Profile\n   - Change password to secure one\n\n---\n\n## Database Seeding\n\n### Option 1: Manual Seed via Shell\n\n1. **Open Shell in Web Service:**\n   - Go to your web service on Render\n   - Click **\"Shell\"** tab\n   - Run:\n   ```bash\n   npx tsx prisma/seed.ts\n   ```\n\n2. **Verify Seeding:**\n   ```bash\n   # Check seeded data\n   npx prisma studio\n   # Opens Prisma Studio in browser\n   ```\n\n### Option 2: Seed Script Upload\n\n1. **Create Manual Seed Script:**\n   ```javascript\n   // In Render shell\n   node << 'EOF'\n   const { PrismaClient } = require\\('@prisma/client'\\);\n   const bcrypt = require\\('bcryptjs'\\);\n   \n   const prisma = new PrismaClient\\(\\);\n   \n   async function main\\(\\) {\n     // Create admin user\n     const hashedPassword = await bcrypt.hash\\('Admin@123', 10\\);\n     await prisma.user.upsert\\({\n       where: { email: 'admin@erp.com' },\n       update: {},\n       create: {\n         name: 'Admin User',\n         email: 'admin@erp.com',\n         passwordHash: hashedPassword,\n         role: 'ADMIN',\n       },\n     }\\);\n     \n     console.log\\('✓ Admin user created'\\);\n   }\n   \n   main\\(\\)\n     .then\\(\\(\\) => process.exit\\(0\\)\\)\n     .catch\\(\\(e\\) => {\n       console.error\\(e\\);\n       process.exit\\(1\\);\n     }\\);\n   EOF\n   ```\n\n### Option 3: Import from Excel \\(Recommended\\)\n\nUse the built-in migration scripts:\n\n1. **Upload Excel Files:**\n   - Use file upload feature \\(if implemented\\)\n   - Or copy files to `/tmp` in shell\n\n2. **Run Migration Scripts:**\n   ```bash\n   # Customer import\n   npx tsx scripts/migration/migrate-customers.ts\n   \n   # Product specs import\n   npx tsx scripts/migration/migrate-product-specs.ts\n   \n   # Inventory import\n   npx tsx scripts/migration/migrate-inventory.ts\n   ```\n\n---\n\n## Troubleshooting\n\n### Build Failures\n\n**Error: \"Cannot find module '@prisma/client'\"**\n```bash\n# Solution: Ensure Prisma generate runs\nBuild Command: npm ci && npx prisma generate && npm run build\n```\n\n**Error: \"Database connection failed\"**\n```bash\n# Check DATABASE_URL format:\npostgresql://user:password@host:port/database?schema=public&connection_limit=10\n```\n\n**Error: \"Out of memory\"**\n```bash\n# Add to environment variables:\nNODE_OPTIONS=--max-old-space-size=4096\n```\n\n### Runtime Errors\n\n**Error: \"Cannot connect to database\"**\n1. Check DATABASE_URL is correct \\(Internal URL, not External\\)\n2. Verify database is running \\(green status\\)\n3. Check connection limits \\(default: 10\\)\n\n**Error: \"Unauthorized\" on login**\n1. Verify NEXTAUTH_SECRET is set\n2. Check JWT_SECRET is set\n3. Verify NEXTAUTH_URL matches your domain\n\n**Error: \"Health check failing\"**\n1. Check `/api/health` endpoint exists\n2. Verify database connection\n3. Check Render logs for errors\n\n### Slow Initial Load\n\n**Free Tier Sleep:**\n- Free services sleep after 15 minutes of inactivity\n- First request takes 30-50 seconds to wake up\n- Upgrade to Starter plan for 24/7 availability\n\n**Solution:**\n1. Upgrade to paid plan \\($7/month\\)\n2. Or use cron job to keep alive:\n   ```bash\n   # Use cron-job.org to ping your app every 10 minutes\n   curl https://your-app-name.onrender.com/api/health\n   ```\n\n---\n\n## Monitoring & Maintenance\n\n### 1. Monitor Application Health\n\n**Render Dashboard:**\n- View real-time logs\n- Check CPU/Memory usage\n- Monitor response times\n\n**Health Check Endpoint:**\n```bash\n# Set up uptime monitoring \\(e.g., UptimeRobot\\)\nURL: https://your-app-name.onrender.com/api/health\nInterval: 5 minutes\n```\n\n### 2. Database Backups\n\n**Automatic Backups \\(Paid Plans\\):**\n- Starter: Daily backups \\(7-day retention\\)\n- Pro: Continuous backups\n\n**Manual Backup:**\n```bash\n# Connect to database\npg_dump $DATABASE_URL > backup_$\\(date +%Y%m%d\\).sql\n\n# Restore\npsql $DATABASE_URL < backup_20260212.sql\n```\n\n### 3. View Logs\n\n**Real-time Logs:**\n```bash\n# In Render Dashboard:\nService → Logs → Live Logs\n```\n\n**Download Logs:**\n```bash\n# Click \"Download Logs\" for historical data\n```\n\n### 4. Scaling\n\n**Vertical Scaling:**\n- Upgrade to Standard \\($25/month\\) for more resources\n- Pro \\($85/month\\) for high performance\n\n**Horizontal Scaling:**\n- Add more instances \\(Pro plan\\)\n- Configure load balancing\n\n### 5. Custom Domain\n\n1. **Add Custom Domain:**\n   - Service → Settings → Custom Domains\n   - Add domain: `erp.yourcompany.com`\n\n2. **Update DNS:**\n   ```\n   Type: CNAME\n   Name: erp\n   Value: your-app-name.onrender.com\n   ```\n\n3. **Update Environment:**\n   ```\n   NEXTAUTH_URL = https://erp.yourcompany.com\n   ```\n\n### 6. SSL Certificate\n\n- Automatic SSL \\(Let's Encrypt\\)\n- Free with all domains\n- Auto-renewal every 90 days\n\n---\n\n## Performance Optimization\n\n### 1. Database Connection Pooling\n\nUpdate DATABASE_URL:\n```\npostgresql://user:pass@host:port/db?connection_limit=10&pool_timeout=20\n```\n\n### 2. Caching Strategy\n\nAdd Redis \\(optional\\):\n```yaml\n# In render.yaml, add:\n- type: redis\n  name: nps-erp-cache\n  plan: starter\n```\n\n### 3. CDN for Static Assets\n\n- Render automatically serves static files via CDN\n- No additional configuration needed\n\n### 4. Database Indexing\n\nEnsure Prisma schema has proper indexes:\n```prisma\n@@index\\([field1, field2]\\)\n```\n\n---\n\n## Cost Estimation\n\n### Free Tier\n- **Web Service:** Free \\(with sleep\\)\n- **PostgreSQL:** Free \\(1GB storage\\)\n- **Total:** $0/month\n\n### Starter Tier \\(Recommended\\)\n- **Web Service:** $7/month \\(512MB RAM, no sleep\\)\n- **PostgreSQL:** $7/month \\(1GB storage, daily backups\\)\n- **Total:** $14/month\n\n### Standard Tier \\(Production\\)\n- **Web Service:** $25/month \\(2GB RAM\\)\n- **PostgreSQL:** $20/month \\(10GB storage\\)\n- **Total:** $45/month\n\n---\n\n## Security Checklist\n\n- [x] Change default admin password\n- [x] Set strong NEXTAUTH_SECRET\n- [x] Set strong JWT_SECRET\n- [x] Enable SSL \\(automatic\\)\n- [x] Set NODE_ENV=production\n- [x] Disable database external access\n- [x] Review user roles and permissions\n- [ ] Set up 2FA for Render account\n- [ ] Configure IP allowlist for database\n- [ ] Set up monitoring alerts\n\n---\n\n## Rollback Strategy\n\n### Rollback to Previous Version\n\n1. **Go to Service → Deploy**\n2. **Find previous deploy in history**\n3. **Click \"Rollback to this version\"**\n4. **Confirm rollback**\n\n### Manual Rollback\n\n```bash\n# Revert git commit\ngit revert HEAD\ngit push origin master\n\n# Render will auto-deploy previous version\n```\n\n---\n\n## Support Resources\n\n- **Render Docs:** https://render.com/docs\n- **Render Community:** https://community.render.com\n- **Prisma Docs:** https://www.prisma.io/docs\n- **Next.js Docs:** https://nextjs.org/docs\n\n---\n\n## Quick Commands Reference\n\n```bash\n# Health check\ncurl https://your-app.onrender.com/api/health\n\n# View logs\n# Use Render Dashboard → Logs\n\n# Run migrations\n# Automatically runs during build\n\n# Seed database\nnpx tsx prisma/seed.ts\n\n# Open Prisma Studio\nnpx prisma studio\n\n# Generate new secret\nnode -e \"console.log\\(require\\('crypto'\\).randomBytes\\(32\\).toString\\('hex'\\)\\)\"\n```\n\n---\n\n## Deployment Checklist\n\n### Pre-Deployment\n- [x] TypeScript compilation passes\n- [x] Production build succeeds\n- [x] All tests pass\n- [x] Environment variables documented\n- [x] Health check endpoint created\n- [x] render.yaml configured\n\n### During Deployment\n- [ ] Create PostgreSQL database on Render\n- [ ] Create web service on Render\n- [ ] Configure environment variables\n- [ ] Deploy application\n- [ ] Wait for build to complete\n\n### Post-Deployment\n- [ ] Verify health check passes\n- [ ] Run database migrations \\(auto\\)\n- [ ] Seed database with initial data\n- [ ] Test login with admin credentials\n- [ ] Change default admin password\n- [ ] Test core functionality\n- [ ] Set up monitoring\n- [ ] Configure custom domain \\(optional\\)\n\n---\n\n**Deployment Guide Version:** 1.0\n**Last Updated:** February 12, 2026\n**Status:** Ready for Production Deployment\n\n---\n\n## Next Steps\n\n1. ✅ Review this deployment guide\n2. ⏭️ Create Render account\n3. ⏭️ Push code to GitHub\n4. ⏭️ Deploy using Blueprint method\n5. ⏭️ Verify deployment\n6. ⏭️ Seed database\n7. ⏭️ Begin UAT on production URL\n\n**Questions? Check troubleshooting section or contact support.**\n\n---\n\n**End of Render Deployment Guide**\nEOF)",
      "Bash(node create-admin.js:*)",
      "Bash(DATABASE_URL='postgresql://erp_user:WkuRJfCBZmQw6V9midS2Acqh5bxxOIBA@dpg-d66dqgmsb7us73e7kn20-a.oregon-postgres.render.com/erp_claude?sslmode=require' npx tsx:*)",
      "Bash(find:*)",
      "Bash(git push:*)"
    ]
  }
}
